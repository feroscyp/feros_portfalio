<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>SQL Project - Brazilian E-commerce | Fernando Ordinola</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Data Analytics">
    <meta name="generator" content="Hugo 0.111.3">
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    

    
<link rel="stylesheet" href="https://feroscyp.github.io/ferosc_portfolio/ananke/css/main.min.css" >



    
    
    
      

    

    
    
    <meta property="og:title" content="SQL Project - Brazilian E-commerce" />
<meta property="og:description" content="Data Analytics" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://feroscyp.github.io/ferosc_portfolio/en/post/chapter-6/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-04-15T11:00:59-04:00" />
<meta property="article:modified_time" content="2023-04-15T11:00:59-04:00" /><meta property="og:site_name" content="Fernando Ordinola" />
<meta itemprop="name" content="SQL Project - Brazilian E-commerce">
<meta itemprop="description" content="Data Analytics"><meta itemprop="datePublished" content="2023-04-15T11:00:59-04:00" />
<meta itemprop="dateModified" content="2023-04-15T11:00:59-04:00" />
<meta itemprop="wordCount" content="871">
<meta itemprop="keywords" content="MySQL,Python,Pandas,MySQL WorkBench," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SQL Project - Brazilian E-commerce"/>
<meta name="twitter:description" content="Data Analytics"/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  <header class="cover bg-top" style="background-image: url('https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_4.png');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://feroscyp.github.io/ferosc_portfolio/en/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Fernando Ordinola
      
    </a>
    <div class="flex-l items-center">
      
<h4></h4>
<ul class="pl0 mr3">
    
    <li class="list f5 f4-ns fw4 dib pr3">
        <a class="hover-white no-underline white-90" href="https://feroscyp.github.io/ferosc_portfolio/post/chapter-6/">es</a>
    </li>
    
</ul>


      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://feroscyp.github.io/ferosc_portfolio/en/about/" title="About me page">
              About me
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://feroscyp.github.io/ferosc_portfolio/en/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://feroscyp.github.io/ferosc_portfolio/en/post/" title="Projects page">
              Projects
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
    
    <a href="https://github.com/feroscyp" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <div class="f2 f1-l fw2 white-90 mb0 lh-title">SQL Project - Brazilian E-commerce</div>
          
            <div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              Data Analytics
            </div>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        PROJECTS
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">SQL Project - Brazilian E-commerce</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2023-04-15T11:00:59-04:00">April 15, 2023</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>In this project, we tackle a dataset from a Brazilian e-commerce company. It is a fairly comprehensive dataset that consists of various tables, which provides us with the opportunity to perform multiple interesting queries. These tables contain real commercial information that has been anonymized.</p>
<p>Dataset source:</p>
<ul>
<li><a href="https://www.kaggle.com/datasets/olistbr/brazilian-ecommerce">https://www.kaggle.com/datasets/olistbr/brazilian-ecommerce</a></li>
</ul>
<p>Project tables:</p>
<ul>
<li>&lsquo;olist_customers_dataset.csv&rsquo;</li>
<li>&lsquo;olist_geolocation_dataset.csv&rsquo;</li>
<li>&lsquo;olist_orders_dataset.csv&rsquo;</li>
<li>&lsquo;olist_order_items_dataset.csv&rsquo;</li>
<li>&lsquo;olist_order_payments_dataset.csv&rsquo;</li>
<li>&lsquo;olist_order_reviews_dataset.csv&rsquo;</li>
<li>&lsquo;olist_products_dataset.csv&rsquo;</li>
<li>&lsquo;olist_sellers_dataset.csv&rsquo;</li>
<li>&lsquo;product_category_name_translation.csv&rsquo;</li>
</ul>
<p>The logical approach would be to start by uploading these files through a database manager like MySQL Workbench or phpMyAdmin. However, in this case, we will use the Python SQLAlchemy library to create an engine and upload the files more quickly. We will automate the data types in each column, also considering the appropriate numeric data format for each case in order to optimize space and memory. This code can be used in other situations to save the effort of uploading files one by one to a database, defining the formats in each column.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_2.png"/>
</figure>

<p>By doing this, we may encounter the issue of the maximum number of allowed packets in the operation. To solve this, you can modify the my.ini file located in the path where you have MySQL Server installed.</p>
<p>Now we can see that we have all the files uploaded to our database, and we make this small query to check the data type in which some columns were uploaded.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_3.png"/>
</figure>

<p>Using the EER Model provided by MySQL Workbench, we build the relationship in the data to have a more general view of the structure.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_4.png"/>
</figure>

<p>We can see that the only table I left without a relationship was olist_geolocation_dataset because it does not contain columns with unique values. One might think that the &ldquo;zip_code&rdquo; column could be a good option, but upon reviewing each zip code, it repeats many times, so that is ruled out.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_6.png"/>
</figure>

<p>We could also consider the option of a combined primary key that groups the 3 columns, but it does not generate unique records either, resulting in an error.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_7.png"/>
</figure>

<p>It would be good practice to model the clear relationship between this table and the <strong><em>olist_sellers_dataset</em></strong> and <strong><em>olist_customers_dataset</em></strong> tables since they contain columns that reference their city, state, and zip code. To define foreign keys, we need a primary key in the __<em>olist_geolocation_dataset</em> __table.</p>
<p>One possible solution is to create a column with unique values that refers to a geolocation ID, for example, a column called &ldquo;geolocation_id,&rdquo; and create it in the other 2 customer and seller tables as well to establish the relationship.</p>
<p>Since there are matches in the city (city), state (state), or zip code (zip code prefix) attributes between the datasets, which would allow for easy queries without the need for a &ldquo;geolocation_id,&rdquo; it seems that it is not strictly necessary to create it. Therefore, for practical purposes in this project, that part will be omitted since limited computational resources cause the server to crash easily due to the size of the dataset when generating the query.</p>
<p>We proceed to synchronize the EER model with the database we have so that we can define all the relationships we created in the diagram. With this option, we can also immediately see any changes we make in the diagram.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_5.png"/>
</figure>

<p>Next, we generate some SQL queries in an exploratory manner to answer recurring business inquiries. The detailed code can be found in the project link at the end of this page.</p>
<p>Something that caught my interest to query was the number of products in each category along with the respective sales count.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> pc.product_category_name_english <span style="color:#66d9ef">AS</span> category, <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#66d9ef">AS</span> total_products, <span style="color:#66d9ef">SUM</span>(oi.order_item_id) <span style="color:#66d9ef">AS</span> total_sales
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> olist_products_dataset p
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> product_category_name_translation pc <span style="color:#66d9ef">ON</span> p.product_category_name <span style="color:#f92672">=</span> pc.product_category_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> olist_order_items_dataset oi <span style="color:#66d9ef">ON</span> p.product_id <span style="color:#f92672">=</span> oi.product_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> pc.product_category_name_english
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> total_products <span style="color:#66d9ef">DESC</span>;
</span></span></code></pre></div><p>We can see that the predominant category is bed_bath_table, with the highest number of products and apparently more sales.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecomm_9.png"/>
</figure>

<p>Now let&rsquo;s see if the top 10 customers in this category make repeat purchases or if they are one-time purchases. Let&rsquo;s also display the top 10 orders in terms of monetary value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">c</span>.customer_id, <span style="color:#66d9ef">c</span>.customer_city, <span style="color:#66d9ef">c</span>.customer_state, <span style="color:#66d9ef">COUNT</span>(<span style="color:#66d9ef">DISTINCT</span> o.order_id) <span style="color:#66d9ef">AS</span> total_orders, <span style="color:#66d9ef">SUM</span>(oi.price) <span style="color:#66d9ef">AS</span> total_amount
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> olist_customers_dataset <span style="color:#66d9ef">c</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> olist_orders_dataset o <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">c</span>.customer_id <span style="color:#f92672">=</span> o.customer_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> olist_order_items_dataset oi <span style="color:#66d9ef">ON</span> o.order_id <span style="color:#f92672">=</span> oi.order_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> olist_products_dataset p <span style="color:#66d9ef">ON</span> oi.product_id <span style="color:#f92672">=</span> p.product_id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">JOIN</span> product_category_name_translation pc <span style="color:#66d9ef">ON</span> p.product_category_name <span style="color:#f92672">=</span> pc.product_category_name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> pc.product_category_name_english <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;bed_bath_table&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">c</span>.customer_id, <span style="color:#66d9ef">c</span>.customer_unique_id, <span style="color:#66d9ef">c</span>.customer_city, <span style="color:#66d9ef">c</span>.customer_state
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> total_amount <span style="color:#66d9ef">DESC</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>;
</span></span></code></pre></div><p>We can see that although the amounts are considerable, they are one-time orders. These customers apparently are not recurring or are making their first purchase on this e-commerce platform. We also observe that the city of origin does not follow a pattern as they come from different cities.</p>
<figure><img src="https://feroscyp.github.io/ferosc_portfolio/images/bras_ecom_13.png"/>
</figure>

<p>Other interesting queries that can be performed with this project and can be found in detail in the GitHub link for this project, where you will find all the available code, include:</p>
<ul>
<li>Total number of customers</li>
<li>Total number of orders placed</li>
<li>Distribution of customer states</li>
<li>Number of orders by customer state</li>
<li>Number of orders by delivery state</li>
<li>Total value of payments processed by payment type</li>
<li>Number of products per category</li>
<li>Number of reviews by rating</li>
<li>Average order delivery time</li>
</ul>
<p>In the future, I will use this same database to visualize data with different software such as Power Bi, Qlik, or Tableau!</p>
<p><a href="https://github.com/feroscyp/brazilian_Ecommerce">Link to Github Repository</a></p>
<ul class="pa0">
  
   <li class="list di">
     <a href="https://feroscyp.github.io/ferosc_portfolio/en/tags/mysql/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MySQL</a>
   </li>
  
   <li class="list di">
     <a href="https://feroscyp.github.io/ferosc_portfolio/en/tags/python/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Python</a>
   </li>
  
   <li class="list di">
     <a href="https://feroscyp.github.io/ferosc_portfolio/en/tags/pandas/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Pandas</a>
   </li>
  
   <li class="list di">
     <a href="https://feroscyp.github.io/ferosc_portfolio/en/tags/mysql-workbench/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MySQL WorkBench</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="https://feroscyp.github.io/ferosc_portfolio/en/post/chapter-5/">Chat Group Whatsapp - Data Analytics</a>
        </li>
	    
	     <li  class="mb2">
          <a href="https://feroscyp.github.io/ferosc_portfolio/en/post/chapter-3/">Polarity Predictions on Tweets</a>
        </li>
	    
	     <li  class="mb2">
          <a href="https://feroscyp.github.io/ferosc_portfolio/en/post/chapter-4/">Predicting Arrests - New York City</a>
        </li>
	    
	     <li  class="mb2">
          <a href="https://feroscyp.github.io/ferosc_portfolio/en/post/chapter-2/">Likelihood of earning a salary above a set threshold using Logistic Regression</a>
        </li>
	    
	     <li  class="mb2">
          <a href="https://feroscyp.github.io/ferosc_portfolio/en/post/chapter-1/">Predicting students who might perform poorly on grades using OLS.</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://feroscyp.github.io/ferosc_portfolio/en/" >
    &copy;  Fernando Ordinola 2023 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://github.com/feroscyp" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
